#!/bin/sh

check() {
        type "$*" >/dev/null || {
                echo "\033[1;31mError:\033[0m command \033[1;34m$*\033[0m not found."
                exit 1
        }
}

check grim
check convert
check slurp
check wl-copy
check wl-paste

_grab="$(slurp -p -b '#00000000' 2>/dev/null)"

[ "${_grab}" ] || {
        notify-send -u normal -a colorpicker -i gcolor3 'Warning â˜ ï¸' 'Failed to pick color. ðŸ˜¥'
        exit 1
}

pick() {
        grim -g "${_grab}" -t ppm - |
                convert - -format '%[pixel:p{0,0}]' txt:- |
                awk 'NR>1 {print $(NF-1),$NF}'
}

pick | cut -d\  -f1 | tr '[:upper:]' '[:lower:]' | wl-copy -n

description=$(pick | cut -d\  -f2)
description=${description#s}

_color=$(wl-paste)
_tmp="/tmp/color.ppm"

convert -size 80x80 xc:"${_color}" "${_tmp}"
notify-send -u low -a colorpicker -i "${_tmp}" "ðŸŽ¨ ${_color}" "${description}"
